---
title: Authentication Guide
description: 'Complete guide to authenticating with CareerK API'
---

# Authentication Guide

CareerK uses JWT (JSON Web Tokens) for secure authentication. This guide explains how to implement authentication in your frontend application.

## Authentication Flow

<Steps>
  <Step title="Register">
    User creates an account as Job Seeker or Company
  </Step>
  <Step title="Email Verification">
    User receives 6-digit OTP via email and verifies
  </Step>
  <Step title="Login">
    User logs in with email and password (for returning users)
  </Step>
  <Step title="Access Protected Resources">
    Use access token to make authenticated API calls
  </Step>
  <Step title="Token Refresh">
    Automatically refresh expired access tokens
  </Step>
  <Step title="Password Recovery">
    Reset forgotten passwords using OTP verification
  </Step>
</Steps>

## Token Types

### Access Token
- **Lifetime**: 1 hour (3600 seconds)
- **Purpose**: Authenticate API requests
- **Storage**: Store in memory or state management (Redux, Zustand, etc.)
- **Usage**: Include in `Authorization` header

### Refresh Token
- **Lifetime**: 24 hours (86400 seconds)
- **Purpose**: Obtain new access tokens
- **Storage**: HTTP-only cookie (automatically managed by browser)
- **Usage**: Sent automatically with requests to `/auth/refresh-token`

<Warning>
  **Never store tokens in localStorage or sessionStorage** - they are vulnerable to XSS attacks. The refresh token is automatically stored in an HTTP-only cookie by the server.
</Warning>

## Implementation Guide

### 1. Register a New User

#### Job Seeker Registration

```javascript
async function registerJobSeeker(userData) {
  const response = await fetch('http://localhost:3000/auth/register/job-seeker', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      email: userData.email,
      password: userData.password,
      firstName: userData.firstName,
      lastName: userData.lastName
    })
  });

  const result = await response.json();
  
  if (!response.ok) {
    throw new Error(result.message);
  }

  return result;
  // Returns: { success: true, data: { email: 'user@example.com' }, message: 'Registration successful...' }
}
```

#### Company Registration

```javascript
async function registerCompany(companyData) {
  const response = await fetch('http://localhost:3000/auth/register/company', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      email: companyData.email,
      password: companyData.password,
      name: companyData.name,
      industry: companyData.industry,
      size: companyData.size, // 'SIZE_1_50', 'SIZE_51_200', 'SIZE_201_1000', 'SIZE_1000_PLUS'
      type: companyData.type  // 'STARTUP', 'SCALE_UP', 'ENTERPRISE', 'NON_PROFIT', 'GOVERNMENT'
    })
  });

  const result = await response.json();
  
  if (!response.ok) {
    throw new Error(result.message);
  }

  return result;
}
```

### 2. Verify Email with OTP

After registration, users receive a 6-digit OTP code via email:

```javascript
async function verifyEmail(email, code) {
  const response = await fetch('http://localhost:3000/auth/verify-email', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    credentials: 'include', // Important! Enables cookies
    body: JSON.stringify({
      email: email,
      code: code // 6-digit OTP from email
    })
  });

  const result = await response.json();
  
  if (!response.ok) {
    throw new Error(result.message);
  }

  // Store access token
  const { accessToken, ...userData } = result.data;
  
  return {
    accessToken,
    user: userData
  };
}
```

<Note>
  The `credentials: 'include'` option is **required** to allow the browser to store and send the HTTP-only refresh token cookie.
</Note>

### 3. Password Reset (Forgot Password)

If a user forgets their password, they can reset it using a two-step process:

#### Step 1: Request Password Reset Code

```javascript
async function forgotPassword(email) {
  const response = await fetch('http://localhost:3000/auth/forgot-password', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      email: email
    })
  });

  const result = await response.json();
  
  if (!response.ok) {
    throw new Error(result.message);
  }

  return result;
  // Returns: { success: true, data: { email: 'user@example.com' }, message: '...' }
  // User receives 6-digit OTP via email (if account exists)
}
```

#### Step 2: Reset Password with OTP

```javascript
async function resetPassword(email, code, newPassword) {
  const response = await fetch('http://localhost:3000/auth/reset-password', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      email: email,
      code: code, // 6-digit OTP from email
      newPassword: newPassword
    })
  });

  const result = await response.json();
  
  if (!response.ok) {
    throw new Error(result.message);
  }

  return result;
  // Returns: { success: true, data: { message: 'Password has been reset successfully' }, ... }
  // All active sessions are logged out - user must login again
}
```

<Warning>
  **All Sessions Logged Out**: After a successful password reset, all active sessions are automatically terminated for security. The user must login again with the new password.
</Warning>

### 4. Login (Returning Users)

```javascript
async function login(email, password) {
  const response = await fetch('http://localhost:3000/auth/login', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    credentials: 'include', // Important! Enables cookies
    body: JSON.stringify({
      email: email,
      password: password
    })
  });

  const result = await response.json();
  
  if (!response.ok) {
    throw new Error(result.message);
  }

  const { accessToken, ...userData } = result.data;
  
  return {
    accessToken,
    user: userData
  };
}
```

### 5. Making Authenticated Requests

Include the access token in the Authorization header:

```javascript
async function fetchUserProfile(accessToken) {
  const response = await fetch('http://localhost:3000/job-seekers/profile', {
    method: 'GET',
    headers: {
      'Authorization': `Bearer ${accessToken}`,
      'Content-Type': 'application/json',
    },
    credentials: 'include'
  });

  if (!response.ok) {
    throw new Error('Failed to fetch profile');
  }

  return await response.json();
}
```

### 6. Refresh Access Token

When the access token expires (after 1 hour), get a new one:

```javascript
async function refreshAccessToken() {
  const response = await fetch('http://localhost:3000/auth/refresh-token', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    credentials: 'include', // Sends the refresh token cookie
  });

  if (!response.ok) {
    // Refresh token expired or invalid - redirect to login
    throw new Error('Session expired. Please login again.');
  }

  const result = await response.json();
  return result.accessToken;
}
```

## Complete React Example

Here's a complete authentication implementation using React hooks:

```jsx
import { create } from 'zustand';

// Zustand store for auth state
const useAuthStore = create((set) => ({
  accessToken: null,
  user: null,
  setAuth: (accessToken, user) => set({ accessToken, user }),
  clearAuth: () => set({ accessToken: null, user: null }),
}));

// API client with automatic token refresh
class ApiClient {
  baseUrl = 'http://localhost:3000';

  async request(endpoint, options = {}) {
    const { accessToken } = useAuthStore.getState();
    
    const config = {
      ...options,
      headers: {
        'Content-Type': 'application/json',
        ...(accessToken && { 'Authorization': `Bearer ${accessToken}` }),
        ...options.headers,
      },
      credentials: 'include',
    };

    let response = await fetch(`${this.baseUrl}${endpoint}`, config);

    // If 401 and not already refreshing, try to refresh token
    if (response.status === 401 && !endpoint.includes('/auth/')) {
      const newToken = await this.refreshToken();
      
      if (newToken) {
        // Retry request with new token
        config.headers['Authorization'] = `Bearer ${newToken}`;
        response = await fetch(`${this.baseUrl}${endpoint}`, config);
      }
    }

    return response;
  }

  async refreshToken() {
    try {
      const response = await fetch(`${this.baseUrl}/auth/refresh-token`, {
        method: 'POST',
        credentials: 'include',
      });

      if (response.ok) {
        const data = await response.json();
        useAuthStore.getState().setAuth(data.accessToken, useAuthStore.getState().user);
        return data.accessToken;
      }
      
      // Refresh failed - clear auth and redirect to login
      useAuthStore.getState().clearAuth();
      window.location.href = '/login';
      return null;
    } catch (error) {
      useAuthStore.getState().clearAuth();
      window.location.href = '/login';
      return null;
    }
  }

  // Auth methods
  async registerJobSeeker(data) {
    const response = await this.request('/auth/register/job-seeker', {
      method: 'POST',
      body: JSON.stringify(data),
    });
    return await response.json();
  }

  async login(email, password) {
    const response = await this.request('/auth/login', {
      method: 'POST',
      body: JSON.stringify({ email, password }),
    });
    
    if (response.ok) {
      const result = await response.json();
      const { accessToken, ...user } = result.data;
      useAuthStore.getState().setAuth(accessToken, user);
      return result;
    }
    
    throw new Error((await response.json()).message);
  }

  async verifyEmail(email, code) {
    const response = await this.request('/auth/verify-email', {
      method: 'POST',
      body: JSON.stringify({ email, code }),
    });
    
    if (response.ok) {
      const result = await response.json();
      const { accessToken, ...user } = result.data;
      useAuthStore.getState().setAuth(accessToken, user);
      return result;
    }
    
    throw new Error((await response.json()).message);
  }

  async forgotPassword(email) {
    const response = await this.request('/auth/forgot-password', {
      method: 'POST',
      body: JSON.stringify({ email }),
    });
    return await response.json();
  }

  async resetPassword(email, code, newPassword) {
    const response = await this.request('/auth/reset-password', {
      method: 'POST',
      body: JSON.stringify({ email, code, newPassword }),
    });
    
    if (response.ok) {
      return await response.json();
    }
    
    throw new Error((await response.json()).message);
  }
}

export const apiClient = new ApiClient();

// Usage in components
function LoginForm() {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');

  const handleLogin = async (e) => {
    e.preventDefault();
    try {
      await apiClient.login(email, password);
      // Redirect to dashboard
      window.location.href = '/dashboard';
    } catch (err) {
      setError(err.message);
    }
  };

  return (
    <form onSubmit={handleLogin}>
      {error && <div className="error">{error}</div>}
      <input 
        type="email" 
        value={email} 
        onChange={(e) => setEmail(e.target.value)}
        placeholder="Email"
      />
      <input 
        type="password" 
        value={password} 
        onChange={(e) => setPassword(e.target.value)}
        placeholder="Password"
      />
      <button type="submit">Login</button>
    </form>
  );
}
```

## Token Payload Structure

### Access Token Payload

```json
{
  "sub": "550e8400-e29b-41d4-a716-446655440000",
  "email": "user@example.com",
  "type": "JOB_SEEKER",
  "tokenType": "ACCESS",
  "iat": 1705315800,
  "exp": 1705319400,
  "aud": "localhost:3000",
  "iss": "localhost:3000"
}
```

## Security Best Practices

<AccordionGroup>
  <Accordion title="1. Never Store Tokens in localStorage">
    localStorage is vulnerable to XSS attacks. Store access tokens in memory/state and let the browser handle the HTTP-only refresh token cookie.
  </Accordion>

  <Accordion title="2. Always Use credentials: 'include'">
    This ensures cookies are sent with cross-origin requests, allowing the refresh token to work properly.
  </Accordion>

  <Accordion title="3. Handle Token Expiration">
    Implement automatic token refresh when you receive a 401 response. This provides a seamless user experience.
  </Accordion>

  <Accordion title="4. Use HTTPS in Production">
    Always use HTTPS in production to prevent token interception. The refresh token cookie has the `secure` flag in production.
  </Accordion>

  <Accordion title="5. Clear Tokens on Logout">
    Call the logout endpoint (when implemented) and clear all auth state from your application.
  </Accordion>
</AccordionGroup>

## Common Issues

### 401 Unauthorized

**Problem**: Getting 401 errors on authenticated requests

**Solutions**:
- Verify access token is included in Authorization header
- Check token hasn't expired (valid for 1 hour)
- Try refreshing the token
- Re-login if refresh fails

### CORS Errors

**Problem**: CORS errors when making requests

**Solutions**:
- Ensure API URL is correct
- Add `credentials: 'include'` to fetch options
- Verify CORS is configured on the backend for your domain

### Refresh Token Not Working

**Problem**: Can't refresh access token

**Solutions**:
- Ensure `credentials: 'include'` is set on all requests
- Check browser allows third-party cookies
- Verify refresh token hasn't expired (24 hours)
- Check browser console for cookie-related warnings

## Password Reset Flow

<Steps>
  <Step title="User Requests Reset">
    User clicks "Forgot Password" and submits their email
  </Step>
  <Step title="OTP Sent">
    If account exists, 6-digit OTP is sent via email (valid for 10 minutes)
  </Step>
  <Step title="User Enters Code">
    User enters email, OTP code, and new password
  </Step>
  <Step title="Password Updated">
    System validates OTP and updates password
  </Step>
  <Step title="Sessions Invalidated">
    All active sessions are logged out for security
  </Step>
  <Step title="User Logs In">
    User logs in with new password
  </Step>
</Steps>

## Next Steps

- [Register Job Seeker API](/api-reference/auth/register-job-seeker)
- [Register Company API](/api-reference/auth/register-company)
- [Login API](/api-reference/auth/login)
- [Verify Email API](/api-reference/auth/verify-email)
- [Forgot Password API](/api-reference/auth/forgot-password)
- [Reset Password API](/api-reference/auth/reset-password)
- [Refresh Token API](/api-reference/auth/refresh-token)
